#region license
//
// MXF - Myriadbits .NET MXF library. 
// Read MXF Files.
// Copyright (C) 2015 Myriadbits, Jochem Bakker
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.
//
// For more information, contact me at: info@myriadbits.com
//
#endregion

using Myriadbits.MXF.Identifiers;
using Myriadbits.MXF.Metadata;
using Myriadbits.MXF.Utils;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;

namespace Myriadbits.MXF
{

    /// <summary>
    /// Create the correct MXF pack 
    /// </summary>
    public class MXFPackFactory
    {
        private static readonly IReadOnlyDictionary<ByteArray, Func<MXFPack, MXFPack>> dict = new Dictionary<ByteArray, Func<MXFPack, MXFPack>>(new KeyPartialMatchComparer())
        {
            #region Main Elements
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x05, 0x01, 0x01, 0x0d, 0x01, 0x02, 0x01, 0x01, 0x02), pack => new MXFPartition(pack)} ,               // Header partition
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x05, 0x01, 0x01, 0x0d, 0x01, 0x02, 0x01, 0x01, 0x03), pack => new MXFPartition(pack)},                 // Body partition
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x05, 0x01, 0x01, 0x0d, 0x01, 0x02, 0x01, 0x01, 0x04), pack => new MXFPartition(pack)},                 // Footer partition

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x05, 0x01, 0x01, 0x0d, 0x01, 0x02, 0x01, 0x01, 0x05, 0x01, 0x00), pack => new MXFPrimerPack(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x05, 0x01, 0x01, 0x0d, 0x01, 0x02, 0x01, 0x01, 0x11, 0x01, 0x00), pack => new MXFRIP(pack)},
            #endregion

            #region Essences
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x02, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x05), pack => new MXFEssenceElement(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x02, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x06), pack => new MXFEssenceElement(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x02, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x07), pack => new MXFEssenceElement(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x02, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x15), pack => new MXFEssenceElement(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x02, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x16), pack => new MXFEssenceElement(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x02, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x17), pack => new MXFANCFrameElement(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x02, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x18), pack => new MXFEssenceElement(pack)},


            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x14), pack => new MXFSystemMetaDataSet(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x05, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x04), pack => new MXFSystemMetaDataPack(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x43, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x04, 0x01), pack => new MXFPackageMetaData(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x63, 0x01, 0x01, 0x0d, 0x01, 0x03, 0x01, 0x04, 0x01), pack => new MXFPackageMetaData(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x02, 0x01, 0x01, 0x10, 0x01, 0x00), pack => new MXFIndexTableSegment(pack)},
            #endregion

            #region Metadata

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x02, 0x02, 0x00, 0x00), pack => new MXFCryptographicContext(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x2F, 0x00), pack => new MXFPreface(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x30, 0x00), pack => new MXFIdentification(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x18, 0x00), pack => new MXFContentStorage(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x23, 0x00), pack => new MXFEssenceContainerData(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x19, 0x00), pack => new MXFControlPoint(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x34, 0x00), pack => new MXFPackage(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x36, 0x00), pack => new MXFMaterialPackage(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x37, 0x00), pack => new MXFSourcePackage(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x38, 0x00), pack => new MXFTrack(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x39, 0x00), pack => new MXFEventTrack(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x3A, 0x00), pack => new MXFStaticTrack(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x3B, 0x00), pack => new MXFTimelineTrack(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x3c, 0x00), pack => new MXFParameter(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x00), pack => new MXFSegment(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x05, 0x00), pack => new MXFEssenceGroup(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x06, 0x00), pack => new MXFEvent(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x07, 0x00), pack => new MXFGPITrigger(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x0a, 0x00), pack => new MXFOperationGroup(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x0b, 0x00), pack => new MXFNestedScope(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x0c, 0x00), pack => new MXFPulldown(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x0d, 0x00), pack => new MXFScopeReference(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x0e, 0x00), pack => new MXFSelector(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x0F, 0x00), pack => new MXFSequence(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x10, 0x00), pack => new MXFSourceReference(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x11, 0x00), pack => new MXFSourceClip(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x12, 0x00), pack => new MXFTextClip(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x13, 0x00), pack => new MXFHTMLClip(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x14, 0x00), pack => new MXFTimecodeComponent(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x15, 0x00), pack => new MXFTimecodeStream(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x16, 0x00), pack => new MXFTimecodeStream12M(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x17, 0x00), pack => new MXFTransition(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1a, 0x00), pack => new MXFDefinitionObject(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1b, 0x00), pack => new MXFDataDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1c, 0x00), pack => new MXFOperationDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1d, 0x00), pack => new MXFParameterDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x7f, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1e, 0x00), pack => new MXFPluginDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1f, 0x00), pack => new MXFCodecDefinition(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x7d, 0x00), pack => new MXFOpDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x7e, 0x00), pack => new MXFCompressionDefinition(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x20, 0x00), pack => new MXFContainerDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x21, 0x00), pack => new MXFInterpolationDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x22, 0x00), pack => new MXFDictionary(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x4c, 0x00), pack => new MXFTaggedValueDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x4d, 0x00), pack => new MXFKLVDataDefinition(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x41, 0x00), pack => new MXFDescriptiveMarker(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x57, 0x00), pack => new MXFDynamicMarker(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x58, 0x00), pack => new MXFDynamicClip(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x60, 0x00), pack => new MXFDescriptiveClip(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x08, 0x00), pack => new MXFCommentMarker(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x09, 0x00), pack => new MXFFiller(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x01, 0x01, 0x02, 0x03, 0x01, 0x02, 0x10, 0x01, 0x00, 0x00, 0x00), pack => new MXFFillerData(pack)}, // Filler
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x02, 0x10, 0x01, 0x00, 0x00, 0x00), pack => new MXFFillerData(pack)}, // Old filler
            #endregion

            #region Descriptors
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x25, 0x00), pack => new MXFFileDescriptor(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x26, 0x00), pack => new MXFAIFCDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x27, 0x00), pack => new MXFPictureDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x28, 0x00), pack => new MXFCDCIDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x2a, 0x00), pack => new MXFHTMLDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x2b, 0x00), pack => new MXFTIFFDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x2c, 0x00), pack => new MXFWAVEDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x51, 0x00), pack => new MXFMPEGPictureEssenceDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x52, 0x00), pack => new MXFParsedTextDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5d, 0x00), pack => new MXFDCPCMSoundDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5e, 0x00), pack => new MXFMPEGAudioDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5f, 0x00), pack => new MXFVC1VideoDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x29, 0x00), pack => new MXFRGBAPictureEssenceDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x42, 0x00), pack => new MXFSoundEssenceDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x43, 0x00), pack => new MXFDataEssenceDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x44, 0x00), pack => new MXFMultipleDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x49, 0x00), pack => new MXFPhysicalDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x4a, 0x00), pack => new MXFImportDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x31, 0x00), pack => new MXFLocator(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x32, 0x00), pack => new MXFNetworkLocator(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x33, 0x00), pack => new MXFTextLocator(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x61, 0x00), pack => new MXFEssenceDescriptor(pack)}, // TODO Application Plug-in object
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x62, 0x00), pack => new MXFEssenceDescriptor(pack)}, // TODO Application Referenced object
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x69, 0x00), pack => new MXFTIFFPictureEssenceDescriptor(pack)},


            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x47, 0x00), pack => new MXFAES3PCMDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x48, 0x00), pack => new MXFWAVEPCMDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5B, 0x00), pack => new MXFDataEssenceDescriptor(pack)}, // Descriptor: VBI Data Descriptor, SMPTE 436 - 7.3
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x53, 0x00), pack => new MXFSGMLDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5C, 0x00), pack => new MXFDataEssenceDescriptor(pack)}, // Descriptor: ANC Data Descriptor, SMPTE 436 - 7.3

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x64, 0x00), pack => new MXFDCTimedTextDescriptor(pack)},
            #endregion

            

            #region Sub-Descriptors

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x79, 0x00), pack => new MXFACESPictureSubDescriptor(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x7a, 0x00), pack => new MXFTargetFrameSubDescriptor(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5a, 0x00), pack => new MXFJPEG2000SubDescriptor(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x81, 0x02), pack => new MXFJPEGXSSubDescriptor(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x59, 0x00), pack => new MXFSubDescriptor(pack)},


            // MCA Label SubDescriptors per SMPTE ST 377-4
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6a, 0x00), pack => new MXFMCALabelSubDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6b, 0x00), pack => new MXFAudioChannelLabelSubDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6c, 0x00), pack => new MXFSoundfieldGroupLabelSubDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6d, 0x00), pack => new MXFGroupOfSoundfieldGroupsLabelSubDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x67, 0x00), pack => new MXFContainerConstraintsSubDescriptor(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6e, 0x00), pack => new MXFAVCSubDescriptor(pack)},

            #endregion

            #region DescriptiveObjects

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x04, 0x02, 0x01, 0x00), pack => new MXFGenericStreamTextBasedSet(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x04, 0x03, 0x01, 0x00), pack => new MXFTextBasedObject(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x04, 0x02, 0x02, 0x00), pack => new MXFUTF8TextBasedSet(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00), pack => new MXFDescriptiveObject(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x01, 0x7f, 0x12, 0x00), pack => new MXFThesaurus(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x01, 0x7f, 0x1a, 0x00), pack => new MXFContact(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x01, 0x1a, 0x04, 0x00), pack => new MXFLocation(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x01, 0x19, 0x01, 0x00), pack => new MXFContactsList(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x01, 0x1b, 0x01, 0x00), pack => new MXFAddress(pack)},

            #endregion

            #region DescriptiveFrameworks

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x04, 0x01, 0x01, 0x00), pack => new MXFTextBasedFramework(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x01, 0x01, 0x01, 0x00), pack => new MXFProductionFramework(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x01, 0x7f, 0x02, 0x00), pack => new MXFProductionClipFramework(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x01, 0x7f, 0x01, 0x00), pack => new MXFDMS1Framework(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x04, 0x01, 0x00, 0x00, 0x00, 0x00), pack => new MXFDescriptiveFramework(pack)},
            #endregion

            #region Uncategorized
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x01, 0x01, 0x3f, 0x00), pack => new MXFTaggedValue(pack)},

            // XMLDocumentText_Indirect
            // urn:smpte:ul:060e2b34.01010105.03010220.01000000
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x01, 0x01, 0x05, 0x03, 0x01, 0x02, 0x20, 0x01, 0x00, 0x00, 0x00), pack => new MXFXMLDocumentText_Indirect(pack)},

            // ItemValue_ISO7
            //urn:smpte:ul:060e2b34.01010105.0301020a.02000000
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x01, 0x01, 0x01, 0x05, 0x03, 0x01, 0x02, 0x0a, 0x02, 0x00, 0x00, 0x00), pack => new MXFItemValue_ISO7(pack)},

            // LensUnitAcquisitionMetadata 
            // urn:smpte:ul:060e2b34.027f0101.0c020101.01010000
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0c, 0x02, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00), pack => new MXFLensUnitAquisitionMetadata(pack)},

            // CameraUnitAcquisitionMetadata 
            // urn:smpte:ul:060e2b34.027f0101.0c020101.02010000
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0c, 0x02, 0x01, 0x01, 0x02, 0x01, 0x00, 0x00), pack => new MXFCameraUnitAquisitionMetadata(pack)},

            // MetaDictionary - urn:smpte:ul:060e2b34.027f0101.0d010101.02250000
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x25, 0x00, 0x00), pack => new MXFMetaDictionary(pack)},

            #endregion

            #region MetaDefinition
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x24, 0x00, 0x00), pack => new MXFMetaDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x03, 0x00, 0x00), pack => new MXFTypeDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x02, 0x00, 0x00), pack => new MXFPropertyDefinition(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x01, 0x00, 0x00), pack => new MXFClassDefinition(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x04, 0x00, 0x00), pack => new MXFTypeDefinitionInteger(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x05, 0x00, 0x00), pack => new MXFTypeDefinitionStrongObjectReference(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x06, 0x00, 0x00), pack => new MXFTypeDefinitionWeakObjectReference(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x07, 0x00, 0x00), pack => new MXFTypeDefinitionEnumeration(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x08, 0x00, 0x00), pack => new MXFTypeDefinitionFixedArray(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x09, 0x00, 0x00), pack => new MXFTypeDefinitionVariableArray(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x0a, 0x00, 0x00), pack => new MXFTypeDefinitionSet(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x0b, 0x00, 0x00), pack => new MXFTypeDefinitionString(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x0c, 0x00, 0x00), pack => new MXFTypeDefinitionStream(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x0d, 0x00, 0x00), pack => new MXFTypeDefinitionRecord(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x0e, 0x00, 0x00), pack => new MXFTypeDefinitionRename(pack)},

            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x20, 0x00, 0x00), pack => new MXFTypeDefinitionExtendibleEnumeration(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x21, 0x00, 0x00), pack => new MXFTypeDefinitionIndirect(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x22, 0x00, 0x00), pack => new MXFTypeDefinitionOpaque(pack)},
            {new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x02, 0x53, 0x01, 0x01, 0x0d, 0x01, 0x01, 0x01, 0x02, 0x23, 0x00, 0x00), pack => new MXFTypeDefinitionCharacter(pack)},
            #endregion

            #region Private Metadata
            // TODO cannot be found in SMPTE official registers ???
            // closest one: OrganizationallyRegisteredAsPrivate 	http://www.smpte-ra.org/reg/400/2012/14 	urn:smpte:ul:060e2b34.04010101.0e000000.00000000
            // "SonyMpeg4ExtraData ???, 
            //{new PartialUL(0x06, 0x0e, 0x2b, 0x34, 0x04, 0x01, 0x01, 0x01, 0x0e, 0x06, 0x06, 0x02, 0x02, 0x01, 0x00, 0x00), pack => new MXFPack(pack)},

            #endregion
        };

        // TODO rename function
        /// <summary>
        /// Create a new MXF object based on the KLV key
        /// </summary>
        /// <param name="reader"></param>
        /// <param name="currentPartition"></param>
        /// <returns></returns>
        public static MXFPack CreateStronglyTypedPack(MXFPack pack)
        {

            if (dict.TryGetValue(pack.Key, out Func<MXFPack,MXFPack> generatorFunction))
            {
                return generatorFunction(pack);
            }
            else if (pack.Key.IdentifiesLocalSet_2BytesLength2BytesTag())
            {
                return new MXFLocalSet(pack);
            }
            else if (pack.Key.IdentifiesEssence())
            {
                return new MXFEssenceElement(pack);
            }
            else
            {
                if (pack.Key.Name == null)
                {
                    string desc = Helper.GetAttributeOfType<DescriptionAttribute>(pack.Key.CategoryDesignator)?.Description ?? string.Empty;
                    pack.Key.Name = $"{desc}";
                }
                return pack;
            }
        }

        public static void SetDescriptionFromAttributeForAllTypes()
        {
            //foreach (Type t in dict.Values)
            //{
            //    SetDescriptionAttribute(t);
            //}
        }

        public static void SetDescriptionFromAttributeForTypes(IEnumerable<Type> types)
        {
            foreach (Type t in types)
            {
                SetDescriptionAttribute(t);
            }
        }

        private static void SetDescriptionAttribute(Type type)
        {
            // recursive calls up to the inheritance chain

            if (type.BaseType != null)
            {
                SetDescriptionAttribute(type.BaseType);
            }

            // iterate through all properties

            foreach (PropertyDescriptor prop in TypeDescriptor.GetProperties(type))
            {
                // get the short key of the property, marked via the ULAttribute 

                var ul = prop.Attributes.OfType<ULElementAttribute>().FirstOrDefault()?.UL;

                if (ul != null)
                {
                    var keyDescription = SMPTERegisters.GetULDescription(ul);
                    if (keyDescription != null)
                    {
                        prop.AddAttribute(new DescriptionAttribute(keyDescription.Definition));
                    }
                }
            }
        }

        // TODO use wildcatd (0x7F) for hashing
        internal class KeyPartialMatchComparer : IEqualityComparer<ByteArray>
        {
            // if the keys to compare are of the same category (meaning the same hash) compare
            // whether the byte sequence is equal
            public bool Equals(ByteArray x, ByteArray y)
            {
                return x.HasSameBeginning(y);
            }

            public int GetHashCode(ByteArray obj)
            {
                // hash only the first 12 bytes (prefix is 4 bytes + 5th byte = key category)
                return obj.ArrayLength >= 12 ? obj.GetHashCode(12) : obj.GetHashCode();
            }
        }
    }
}
